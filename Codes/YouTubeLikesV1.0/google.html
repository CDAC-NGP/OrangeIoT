<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using Google APIs in JavaScript</title>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <h1 id="likes"> Likes</h1>

<script>
    const videoId = '1umJpmeOHq4';
    const apiKey = 'AIzaSyBBIlYm-xe5U0qYxlDXt-UHhQ1YzAdnXZk'; // Replace with your actual API key
    var likesCount;
    var targetCount = 4;

    function init() {
        gapi.load('client', function () {
            gapi.client.init({
                apiKey: apiKey,
                discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest'],
            }).then(function () {
                // Call your function to make YouTube API request here
                getVideoLikes(videoId);
            });
        });
    }

    function getVideoLikes(videoId) {
        gapi.client.youtube.videos.list({
            part: 'snippet,statistics',
            id: videoId,
        }).then(function (response) {
            const likesCount = response.result.items[0].statistics.likeCount;
            console.log(`The video has ${likesCount} likes.`);
            
            // Update the likes count in the HTML
            //document.getElementById('likes').textContent = `Likes: ${likesCount}`;
            useLikesCount(likesCount)
        }, function (error) {
            console.error('Error:', error.result.error.message);
        });
    }

    function useLikesCount(likesCount) {
        if (likesCount >= targetCount){
            const url = 'http://192.168.1.6:5000/actData?id=o101&s1=150&s2=132&do1=1&do2=1';
            fetch(url);

            document.getElementById('likes').textContent = `Likes ${likesCount} :: Target Reached ! Lets Lit Up !!`;
            console.log("Timer is in 1");
        }

        if (likesCount < targetCount){
            const url = 'http://192.168.1.6:5000/actData?id=o101&s1=150&s2=132&do1=0&do2=1';
            fetch(url);
            document.getElementById('likes').textContent = `Likes ${likesCount} :: Target Likes ${targetCount}`;
            console.log("Timer is in 0");
        }        

    }

    function onTimerTick() {
        // Call your function here that you want to run every 2 minutes
        console.log('Timer tick!');
        init();       
        
    }

    // Load the client and make API calls
    init();
    setInterval(onTimerTick,6000);
   
     
 
</script>

<script src="https://apis.google.com/js/client.js?onload=init"></script>


</body>
</html>

<!-- const apiKey = 'AIzaSyBBIlYm-xe5U0qYxlDXt-UHhQ1YzAdnXZk';
const videoId = 'zcbPTpwACmo'; -->
